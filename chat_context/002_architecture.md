# Architecture

## 1. Overview
Проект состоит из нескольких слоёв: сбор данных, хранение и обработка, бизнес-логика, API и фронтенд.  

Цель архитектуры — обеспечить:
- Автоматизированный сбор и обработку данных из открытых источников.
- Централизованное хранение и анализ.
- Удобный интерфейс для пользователей.
- Возможность масштабирования и добавления новых источников данных.

---

## 2. Data Flow

### 2.1 Сбор данных (Data Collection)
- **Источники:**
  - Судебные реестры (ФССП, Арбитражные суды)
  - Государственные реестры недвижимости
  - Площадки объявлений о продаже недвижимости (Avito, CIAN)
  - Форумы и соцсети с жалобами и отзывами
  - Сайты застройщиков и новостные источники

- **Процесс:**
  1. Запланированные парсеры (Celery / Cron) обращаются к источникам.
  2. Полученные данные нормализуются в стандартный формат.
  3. Производится первичная фильтрация — убираются дубли, мусор, некорректные записи.
  4. Метаданные (дата, источник, URL) сохраняются для последующей проверки и прозрачности.

---

### 2.2 Хранение данных (Data Storage)
- **Основное хранилище:** PostgreSQL
  - Таблицы:
    - `developers` — застройщики
    - `sellers` — физические лица
    - `properties` — объекты недвижимости (дома, квартиры)
    - `court_cases` — судебные дела
    - `complaints` — жалобы и отзывы
    - `reports` — история отчетов пользователя
- **Кеш и очередь задач:** Redis + Celery/RabbitMQ
  - Обработка больших массивов данных
  - Асинхронная генерация отчетов
- **Файловое хранилище:** для PDF-отчетов, логов и дополнительных материалов.

---

### 2.3 Обработка данных (Data Processing)
- Проверка связей: застройщик ↔ дом ↔ квартиры
- Проверка физлица ↔ квартира ↔ судебные дела
- Построение агрегатов:
  - Репутация застройщика
  - История продавца
  - Риски по объекту недвижимости
- Подготовка данных для фронтенда:
  - JSON для карты домов и квартир
  - Сводные данные для отчетов
- Возможность обновления данных по объекту при появлении новых сведений

---

### 2.4 API Layer
- **Backend:** Python + FastAPI
- **Функции:**
  - Получение списка застройщиков, продавцов, объектов
  - Запрос отчетов
  - История и обновления для пользователей
  - Фильтры и поиск
- **Входные точки для фронтенда:**
  - REST/GraphQL API
  - Возможность интеграции с внешними сервисами

---

### 2.5 Frontend Layer
- **Технологии:** React + TypeScript
- **Компоненты:**
  - Карта домов с интерактивными квартирами
  - Список квартир и домов
  - Детальный отчет по объекту / продавцу / застройщику
  - История покупок и обновлений
  - Подписки и доступ к расширенным данным

---

## 3. Сценарий работы системы

1. **Сбор данных**
   - Планировщик запускает парсеры → данные поступают в Raw DB.
2. **Предварительная обработка**
   - Дедупликация, нормализация, проверка формата.
3. **Хранение и агрегирование**
   - Данные попадают в основную БД, строятся связи между объектами.
4. **Пользовательский запрос**
   - Пользователь делает запрос через фронтенд → API получает данные из БД.
5. **Генерация отчета**
   - Асинхронно создается PDF/онлайн-отчет.
   - История покупки обновляется.
6. **Обновление данных**
   - Новые сведения автоматически попадают в систему.
   - Пользователь может докупить обновление отчета.

---

## 4. Дополнительно
- Масштабируемость:
  - Можно добавлять новые источники парсинга.
  - Можно добавлять новые типы отчетов.
- Надежность:
  - Кэширование, очереди, резервное копирование.
- Безопасность:
  - Контроль доступа к отчетам и API.
  - Защита данных пользователей и логов.
